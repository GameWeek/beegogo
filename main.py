from machine import Pin,I2C
import ssd1306
#import gfx
from time import sleep_ms,sleep
i2c = I2C(scl=Pin(5), sda=Pin(4), freq=100000)
display = ssd1306.SSD1306_I2C(128, 64, i2c)
#graphics = gfx.GFX(128, 32, display.pixel)
from sprite import Sprite
from screen import Screen     

btn = Pin(16,Pin.OUT)
btn.value(1)
#btn = Pin(10,Pin.IN, Pin.PULL_UP)  


#display.text("1",10, 10)
#graphics.line(0, 0, 127, 20, 1)
#graphics.circle(10, 10, 4, 1)
#display.show()

screen = Screen(128,64,display)
player = Sprite(10,15,['''
0000000000011000000
0000000000011000110
0000000000010000110
0000000000010000100
0000000000010000100
0000000000010000100
0000000111111100100
0000011111110011100
0000101101000000100
0001001001000010110
0001010001000010110
0010011001000010101
0110101001000010101
1110101001000010101
0110101001000000001
0010100001001000001
0001000001000111010
0001011111000000010
0000101111000000100
0000011111100011000
0000000111111100000
''','''
0000000000011000000
0000000000011000110
0000000000010000110
0001110000010000100
0010001000010000100
0100000100010000100
0100000111111100100
0100100011110011100
0100010001000000100
0010011101000010110
0010000101000010110
0011001111000010101
0110111111000010101
1110011111000010101
0110011111000000001
0010011111001000001
0001011111000111010
0001001111000000010
0000101111000000100
0000011111100011000
0000000111111100000
'''])



class Enemy(Sprite):
    def setup(self):
        pass
    def update(self):
        val = btn.value()
        if val==0:
            self.x-=4
            if self.x<=-10:
                self=None


enemy=Enemy(80,40,['''
0001111111111000
0111000000001110
1100000000000011
1000001001000001
1000001001000001
1000000000000001
1100000000000011
0111000000001110
0001111111111000
0110001001000110
1001101001011001
1000011001100001
1000001001000001
0100001001000010
0011000000001100
0000111111110000
'''])

screen.add_player_sprite(player)

screen.clear()
screen.show()

class Game:
    def __init__(self):
        self.time=0
    def timeup(self):
        self.time+=1
    def event(self):
        return self.time % 8==0

game = Game()


def addenemy():
    enemy=Enemy(128,40,['''
0001111111111000
0111000000001110
1100000000000011
1000001001000001
1000001001000001
1000000000000001
1100000000000011
0111000000001110
0001111111111000
0110001001000110
1001101001011001
1000011001100001
1000001001000001
0100001001000010
0011000000001100
0000111111110000
'''])
    screen.add_enemy_sprite(enemy)
    
while True:
    val = btn.value()
    if val==0:
        game.timeup()
        if game.event():
            addenemy()
    screen.show()
    #sleep_ms(1)
